sudo: required
services:
- docker
language: python
python:
- '3.6'
git:
  depth: false
install:
- pip install -c constraints.txt -r requirements.txt
- pip install -c constraints.txt -e .
script:
- flake8
- black --check print-logs run-query setup.py ethindex
- mypy --ignore-missing-imports ethindex
- docker build -t ethindex .
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USER" --password-stdin
deploy:
  skip_cleanup: true
  provider: script
  script: .travis/push-docker-image
  on:
    branch: develop
branches:
  only:
  - master
  - develop
env:
  global:
    - DOCKER_USER=schmir
    - secure: Mzc7Blz1656Zx/rTV39E70SQ3ft8OKuELeLX+7bjUB+s18QJfX8N5xrVtY8AtZdB/m+4HOWac4nSn8HTmGHS6iGSnfxnjL2QeLvQeqzEQKQwrBvjQf5beVm6iexGOtVXK5RTXvhCKNiTnxcVIiTRFMSbNdLQNZl58M6DCinEhkWyu8ZT+YsTRCTtrh6W8crHnN/xIDeDoye4tcTDikd6EOb7a+xWkfqJeqD8W9Qp5fnGDyO2d62cJ76TxV149EwJ1kFNvJ/8qtQgyeV30gS4cRlb77pMNs6F1l2mh58eP0t2x61iY9XKwBmw4LzRspRzXNBYKh5eRIh1jjQ7LN5Fngz7lKOYeugpoSLJVBtu1mVtRwPWBa+LRySb4FFQocJ76AOB9KTe5h0Z9+wd8XqaStB2g3lZYiFIM1OBKvNn2vLgDdfuwRALVp3hhVOe62bGolldKKOK+Cl02yt9ms9XPkTRn2Nsoqb9Sk/cx5THJWcON8004is3WkEw7iRRt50U40AeIUnsJ4nwtWGVsdRQ5UH5KsbLk4tju/RXH/RAk8P3+WUhUiVnQaaUF/Jfi22Xz64w5Nk8jI20A2unpT5eP7SWYEixKA9pUqKiqPYbU4iVRX8Y8tgpPewBZPP70MFQEwC21pW30XVTAsMPI9qUuUqcmchmtnIChzpy0hglXr8=
